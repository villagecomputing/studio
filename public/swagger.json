{
  "openapi": "3.0.0",
  "info": {
    "title": "Labelkit Studio API - OpenAPI 3.0",
    "version": "1.0"
  },
  "servers": [
    {
      "url": "http://localhost:3000"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer"
      }
    },
    "schemas": {
      "Dataset": {
        "AddDataPayload": {
          "type": "object",
          "properties": {
            "datasetId": {
              "type": "string"
            },
            "datasetRows": {
              "type": "array",
              "items": {
                "$ref": "#/components/schemas/Dataset/DatasetRow"
              }
            }
          }
        },
        "DatasetRow": {
          "type": "object",
          "additionalProperies": true,
          "properties": {
            "content": {
              "type": "string"
            },
            "id": {
              "type": "number"
            },
            "status": {
              "type": "string",
              "enum": [
                "PENDING",
                "APPROVED"
              ]
            }
          }
        },
        "DatasetViewResponse": {
          "type": "object",
          "properties": {
            "id": {
              "type": "string"
            },
            "created_at": {
              "type": "string",
              "format": "date-time"
            },
            "name": {
              "type": "string"
            },
            "columns": {
              "type": "array",
              "items": {
                "$ref": "#/components/schemas/Dataset/TableColumnProps"
              }
            },
            "rows": {
              "type": "array",
              "items": {
                "oneOf": [
                  {
                    "type": "string"
                  },
                  {
                    "$ref": "#/components/schemas/DatasetRow"
                  }
                ]
              }
            }
          },
          "required": [
            "id",
            "created_at",
            "name",
            "columns",
            "rows"
          ]
        },
        "TableColumnProps": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "id": {
              "type": "number"
            },
            "field": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "IDENTIFIER",
                "GROUND_TRUTH",
                "GROUND_TRUTH_STATUS",
                "PREDICTIVE_LABEL",
                "INPUT"
              ]
            }
          },
          "required": [
            "name",
            "id",
            "field",
            "type"
          ]
        },
        "NewDatasetPayload": {
          "type": "object",
          "properties": {
            "datasetName": {
              "type": "string"
            },
            "columns": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "groundTruths": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "required": [
            "datasetName",
            "columns",
            "rows"
          ]
        },
        "NewDatasetResponse": {
          "type": "object",
          "properties": {
            "id": {
              "type": "string"
            }
          },
          "required": [
            "id"
          ]
        },
        "UploadDatasetPayload": {
          "type": "object",
          "properties": {
            "datasetData": {
              "type": "object",
              "properties": {
                "datasetTitle": {
                  "type": "string",
                  "description": "The title of the dataset"
                },
                "groundTruthColumnIndex": {
                  "type": "integer",
                  "description": "Index of the ground truth column"
                },
                "blankColumnTitle": {
                  "type": "string",
                  "description": "Title for an optional blank column",
                  "nullable": true
                }
              },
              "required": [
                "datasetTitle",
                "groundTruthColumnIndex"
              ],
              "description": "Object containing the dataset title, ground truth column index, and an optional blank column title",
              "example": {
                "datasetTitle": "Example Title",
                "groundTruthColumnIndex": 2,
                "blankColumnTitle": "Optional Column"
              }
            },
            "file": {
              "type": "string",
              "format": "binary",
              "description": "The binary content of the dataset file"
            }
          },
          "required": [
            "datasetData",
            "file"
          ]
        },
        "DatasetListResponse": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "created_at": {
                "type": "string",
                "format": "date"
              },
              "total_rows": {
                "type": "integer"
              }
            },
            "required": [
              "id",
              "name",
              "created_at",
              "total_rows"
            ]
          }
        },
        "ApproveAllGroundTruthsPayload": {
          "type": "object",
          "properties": {
            "datasetId": {
              "type": "string"
            }
          },
          "required": [
            "datasetId"
          ]
        },
        "EditCellPayload": {
          "type": "object",
          "properties": {
            "datasetId": {
              "type": "string"
            },
            "rowId": {
              "type": "integer"
            },
            "content": {
              "type": "string",
              "nullable": true
            },
            "status": {
              "type": "string",
              "enum": [
                "PENDING",
                "APPROVED"
              ],
              "nullable": true
            }
          },
          "required": [
            "datasetId",
            "rowId"
          ],
          "oneOf": [
            {
              "required": [
                "content"
              ]
            },
            {
              "required": [
                "status"
              ]
            }
          ]
        },
        "EditGroundTruthCellResponse": {
          "type": "object",
          "properties": {
            "id": {
              "type": "integer"
            }
          },
          "required": [
            "id"
          ]
        },
        "EditDatasetColumnPayload": {
          "type": "object",
          "properties": {
            "datasetId": {
              "type": "string"
            },
            "columnId": {
              "type": "string"
            },
            "newName": {
              "type": "string"
            }
          },
          "required": [
            "datasetId",
            "columnId",
            "newName"
          ]
        },
        "EditDatasetColumnResponse": {
          "type": "object",
          "properties": {
            "id": {
              "type": "integer"
            }
          },
          "required": [
            "id"
          ]
        }
      },
      "Experiment": {
        "ExperimentViewResponse": {
          "type": "object",
          "properties": {
            "uuid": {
              "type": "string"
            },
            "name": {
              "type": "string"
            },
            "created_at": {
              "type": "string",
              "format": "date-time"
            },
            "description": {
              "type": "string",
              "nullable": true
            },
            "columns": {
              "type": "array",
              "items": {
                "$ref": "#/components/schemas/Experiment/ExperimentTableColumnPropsSchema"
              }
            },
            "rows": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": {
                  "type": "string"
                }
              }
            },
            "dataset": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "uuid": {
                  "type": "string"
                }
              }
            },
            "latencyP50": {
              "type": "number"
            },
            "latencyP90": {
              "type": "number"
            },
            "cost": {
              "type": "number"
            },
            "accuracy": {
              "type": "number"
            },
            "parameters": {
              "type": "string"
            }
          },
          "required": [
            "uuid",
            "name",
            "created_at",
            "columns",
            "rows",
            "dataset"
          ]
        },
        "ExperimentTableColumnPropsSchema": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "id": {
              "type": "number"
            },
            "field": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "IDENTIFIER",
                "OUTPUT",
                "METADATA"
              ]
            }
          },
          "required": [
            "name",
            "id",
            "field",
            "type"
          ]
        },
        "ExperimentInsertPayload": {
          "type": "object",
          "properties": {
            "steps": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "metadata": {
                    "type": "object",
                    "properties": {
                      "latency": {
                        "type": "number"
                      }
                    },
                    "additionalProperties": {
                      "type": [
                        "number",
                        "string"
                      ]
                    }
                  },
                  "outputs": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "value": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "name",
                        "value"
                      ]
                    }
                  }
                },
                "required": [
                  "name",
                  "metadata",
                  "outputs"
                ]
              }
            }
          },
          "required": [
            "steps"
          ]
        },
        "NewExperimentPayload": {
          "type": "object",
          "properties": {
            "datasetId": {
              "type": "string"
            },
            "name": {
              "type": "string"
            },
            "description": {
              "type": "string",
              "nullable": true
            },
            "parameters": {
              "type": "object",
              "additionalProperties": true
            }
          },
          "required": [
            "name",
            "datasetId",
            "parameters"
          ]
        },
        "NewExperimentResponse": {
          "type": "object",
          "properties": {
            "id": {
              "type": "string"
            }
          },
          "required": [
            "id"
          ]
        },
        "ListExperimentResponse": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "description": {
                "type": "string",
                "nullable": true
              },
              "created_at": {
                "type": "string"
              },
              "groupId": {
                "type": "integer"
              },
              "pipelineMetadata": {
                "type": "string"
              },
              "latencyP50": {
                "type": "number"
              },
              "latencyP90": {
                "type": "number"
              },
              "runtime": {
                "type": "number"
              },
              "totalCost": {
                "type": "number"
              },
              "totalAccuracy": {
                "type": "number"
              },
              "totalRows": {
                "type": "number"
              },
              "Dataset": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "string"
                  },
                  "name": {
                    "type": "string"
                  }
                },
                "required": [
                  "id",
                  "name"
                ]
              }
            },
            "required": [
              "id",
              "name",
              "created_at",
              "groupId",
              "pipelineMetadata",
              "latencyP50",
              "latencyP90",
              "runtime",
              "totalCost",
              "totalAccuracy",
              "totalRows",
              "Dataset"
            ]
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Dataset",
      "description": "Operations related to datasets including listing, creating, populating and retrieving datasets, approving ground truths, editing cells and columns"
    },
    {
      "name": "Experiment",
      "description": "Operations related to experiments including creating, updating, retrieving and listing experiments"
    }
  ],
  "paths": {
    "/api/dataset/[datasetId]/addData": {
      "post": {
        "tags": [
          "Dataset"
        ],
        "summary": "Inserts data into a dataset",
        "parameters": [
          {
            "in": "path",
            "name": "datasetId",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The unique identifier of the dataset."
          }
        ],
        "requestBody": {
          "description": "Data to be added to the dataset",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Dataset/AddDataPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Ok"
          },
          "400": {
            "description": "Missing required data -or- Invalid request headers type"
          },
          "500": {
            "description": "Error processing request"
          }
        }
      }
    },
    "/api/dataset/[datasetId]": {
      "get": {
        "tags": [
          "Dataset"
        ],
        "summary": "Retrieve the details of a specific dataset by its Id.",
        "parameters": [
          {
            "in": "path",
            "name": "datasetId",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The unique identifier of the dataset."
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully retrieved the dataset details.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Dataset/DatasetViewResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid dataset Id provided."
          },
          "500": {
            "description": "Internal server error occurred while processing the request."
          }
        }
      }
    },
    "/api/dataset/edit/approveAll": {
      "post": {
        "tags": [
          "Dataset"
        ],
        "summary": "Approves all ground truths for the specified dataset.",
        "requestBody": {
          "$ref": "#/components/schemas/Dataset/ApproveAllGroundTruthsPayload"
        },
        "responses": {
          "200": {
            "description": "OK"
          },
          "400": {
            "description": "Required data is missing."
          },
          "500": {
            "description": "Error processing request."
          }
        },
        "description": "Approves all ground truths for a given dataset."
      }
    },
    "/api/dataset/edit/cell": {
      "post": {
        "tags": [
          "Dataset"
        ],
        "summary": "Edits a specific cell in a dataset's ground truth.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Dataset/EditCellPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Ground truth cell updated successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EditGroundTruthCellResponse"
                }
              }
            }
          },
          "500": {
            "description": "Error processing result."
          }
        },
        "description": "Edits a ground truth cell in a dataset."
      }
    },
    "/api/dataset/edit/column": {
      "post": {
        "tags": [
          "Dataset"
        ],
        "summary": "Edits an existing column in a dataset.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Dataset/EditDatasetColumnPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Column updated successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Dataset/EditDatasetColumnResponse"
                }
              }
            }
          },
          "500": {
            "description": "Error processing request"
          }
        },
        "description": "Edits a column in a dataset."
      }
    },
    "/api/dataset/list": {
      "get": {
        "tags": [
          "Dataset"
        ],
        "summary": "Retrieves a list of datasets and their total row counts",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Dataset/DatasetListResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid response datasetList type"
          },
          "500": {
            "description": "Error processing request"
          }
        }
      }
    },
    "/api/dataset/new": {
      "post": {
        "tags": [
          "Dataset"
        ],
        "summary": "Initializes a new dataset.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Dataset/NewDatasetPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully created a new dataset.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Dataset/NewDatasetResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request headers type or Missing required data."
          },
          "500": {
            "description": "Error processing request."
          }
        }
      }
    },
    "/api/dataset/upload": {
      "post": {
        "tags": [
          "Dataset"
        ],
        "summary": "Uploads a dataset file and its associated data",
        "requestBody": {
          "description": "Dataset file and data to be uploaded",
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/Dataset/UploadDatasetPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "The newly uploaded dataset Id"
          },
          "400": {
            "description": "Missing required data -or- Invalid request headers type -or- Invalid request dataset type -or- Column Title required for blank ground truth column"
          },
          "500": {
            "description": "File content is missing -or- Error processing request"
          }
        }
      }
    },
    "/api/experiment/[experimentId]/insert": {
      "post": {
        "tags": [
          "Experiment"
        ],
        "summary": "Inserts steps into an experiment with the given Id.",
        "description": "Ensures the experiment is created and inserts the given steps as a row for the given experiment",
        "parameters": [
          {
            "in": "path",
            "name": "experimentId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Experiment/ExperimentInsertPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Ok"
          },
          "500": {
            "description": "Error processing request"
          }
        }
      }
    },
    "/api/experiment/[experimentId]": {
      "get": {
        "tags": [
          "Experiment"
        ],
        "summary": "Fetches the details of an experiment with the specified Id.",
        "parameters": [
          {
            "in": "path",
            "name": "experimentId",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The unique identifier of the experiment to retrieve."
          }
        ],
        "responses": {
          "200": {
            "description": "Experiment data retrieved successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Experiment/ExperimentViewResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid experiment id"
          },
          "500": {
            "description": "Invalid response experiment view type -or- Error processing request"
          }
        }
      }
    },
    "/api/experiment/list": {
      "get": {
        "tags": [
          "Experiment"
        ],
        "summary": "List all experiments",
        "responses": {
          "200": {
            "description": "A list of experiments.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Experiment/ListExperimentResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid response datasetList type."
          },
          "500": {
            "description": "Error processing request."
          }
        }
      }
    },
    "/api/experiment/new": {
      "post": {
        "tags": [
          "Experiment"
        ],
        "summary": "Declare a new experiment for a given dataset Id",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Experiment/NewExperimentPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Experiment/ExperimentResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid dataset id"
          },
          "500": {
            "description": "Error processing request"
          }
        }
      }
    }
  }
}